<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>рдЖрдЧрдВрддреБрдХ рдкрдВрдЬреАрдпрди</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari&display=swap" rel="stylesheet">
  <!-- рдЖрдкрдХреА рдкреБрд░рд╛рдиреА рд╕реНрдЯрд╛рдЗрд▓ -->
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <!-- тЬЕ Active рдЗрд╡реЗрдВрдЯ рдХрд╛ рдирд╛рдо рдпрд╣рд╛рдВ рджрд┐рдЦреЗрдЧрд╛ -->
    <h2 id="formHeading">рднрд╛рдЬрдкрд╛ рдХрд╛рд░реНрдпрд╛рд▓рдп рдкрд░ рдЖрдкрдХрд╛ рд╕реНрд╡рд╛рдЧрдд рд╣реИ</h2>

    <form id="visitor-form" autocomplete="off">
      <!-- рдореЛрдмрд╛рдЗрд▓ рдирдВрдмрд░ -->
      <label for="mobile">рдореЛрдмрд╛рдЗрд▓ рдирдВрдмрд░:</label>
      <div style="display: flex; align-items: center; gap: 8px;">
        <input type="tel" id="mobile" name="mobile" required pattern="[0-9]{10}" placeholder="10 рдЕрдВрдХреЛрдВ рдХрд╛ рдореЛрдмрд╛рдЗрд▓ рдирдВрдмрд░" style="flex: 1;">
        <span id="mobileSearch" title="рдЦреЛрдЬреЗрдВ" style="cursor: pointer; font-size: 20px; margin-top: 4px;">ЁЯФН</span>
      </div>

      <label for="name">рдирд╛рдо:</label>
      <input type="text" id="name" name="name" required placeholder="рдЕрдкрдирд╛ рдирд╛рдо рджрд░реНрдЬ рдХрд░реЗрдВ">

      <label for="designation">рдкрдж:</label>
      <input type="text" id="designation" name="designation" required placeholder="рдЖрдкрдХрд╛ рдкрдж рджрд░реНрдЬ рдХрд░реЗрдВ">

      <label for="address">рдкрддрд╛ / рд╡рд╛рд░реНрдб / рдмреВрде:</label>
      <input type="text" id="address" name="address" required placeholder="рдкреВрд░рд╛ рдкрддрд╛ рд▓рд┐рдЦреЗрдВ">

      <label for="mandal">рдордВрдбрд▓:</label>
      <select id="mandal" name="mandal" required>
        <option value="">рдордВрдбрд▓ рдЪреБрдиреЗрдВ</option>
        <!-- тЬЕ рдкрд╣рд▓реЗ рдЬреИрд╕реЗ static options -->
        <option>рднреЗрдВрд╕реЛрджрд╛</option><option>рднрд╛рдирдкреБрд░рд╛</option><option>рдЧрд░реЛрда</option><option>рдореЗрд▓рдЦреЗрдбрд╛</option>
        <option>рдЦреЬрд╛рд╡рджрд╛</option><option>рд╢рд╛рдордЧреЭ</option><option>рд╕реБрд╡рд╛рд╕рд░рд╛</option><option>рдмрд╕рд╛рдИ</option>
        <option>рд╕реАрддрд╛рдордК</option><option>рдХреНрдпрд╛рдордкреБрд░</option><option>рд╕реАрддрд╛рдордК рдЧреНрд░рд╛рдореАрдг</option><option>рдЧреБрд░реНрдЬрд░ рдмрд░рдбрд┐рдпрд╛</option>
        <option>рдзреБрдВрджрдзреЬрдХрд╛</option><option>рдмреБрдврд╛</option><option>рдкрд┐рдкрд▓рд┐рдпрд╛ рдордВрдбреА</option><option>рдорд▓реНрд╣рд╛рд░рдЧреЭ</option>
        <option>рджрд▓реЛрджрд╛</option><option>рдордЧрд░рд╛рдорд╛рддрд╛ рдЬреА</option><option>рдордВрджрд╕реМрд░ рдЧреНрд░рд╛рдореАрдг</option><option>рдордВрджрд╕реМрд░ рдЙрддреНрддрд░</option>
        <option>рдордВрджрд╕реМрд░ рджрдХреНрд╖рд┐рдг</option><option>рдЕрдиреНрдп рдЬрд┐рд▓реЗ рд╕реЗ рдЖрдпреЗ</option>
      </select>

      <label for="reason">рдЖрдиреЗ рдХрд╛ рдХрд╛рд░рдг:</label>
      <select id="reason" name="reason" required>
        <option value="">рдХрд╛рд░рдг рдЪреБрдиреЗрдВ</option>
        <option>рдХрд╛рд░реНрдпрд╛рд▓рдп рдкрд░ рдмреИрдардХ</option><option>рдЬрд┐рд▓рд╛ рдЕрдзреНрдпрдХреНрд╖ рд╕реЗ рднреЗрдВрдЯ</option>
        <option>рдЯреНрд░рд╛рдВрд╕рдлрд░ / рд╢рд╛рд╕рдХреАрдп рдХрд╛рд░реНрдп / рд╢рд┐рдХрд╛рдпрдд</option><option>рдХрд╛рд░реНрдпрд╛рд▓рдп рдкрд░ рд╕рд╛рдорд╛рдиреНрдп рдЙрдкрд╕реНрдерд┐рддрд┐</option>
        <option>рдЕрдиреНрдп рдХреЛрдИ рдХрд╛рд░реНрдп</option>
      </select>

      <label>рд╕реЗрд▓реНрдлреА рд▓реЗрдВ:</label>
      <video id="camera" autoplay playsinline></video>
      <canvas id="snapshot" style="display:none;"></canvas>
      <input type="hidden" id="selfieData" name="selfieData">
      <input type="button" value="ЁЯУ╖ рдлреЛрдЯреЛ рд▓реЗрдВ" onclick="capturePhoto()">

      <button type="submit">рд╕рдмрдорд┐рдЯ рдХрд░реЗрдВ</button>
    </form>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

  <!-- SweetAlert -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- рдЖрдкрдХрд╛ рдкреБрд░рд╛рдирд╛ рд╕рдмрдорд┐рд╢рди/рдСрдЯреЛрдлрд┐рд▓ рдХреЛрдб -->
  <script src="script.js"></script>

  <!-- тЬЕ Extra: Active Event тЖТ Header + Reason Prefill + рдореЛрдмрд╛рдЗрд▓ рд╕рд░реНрдЪ рдмрдЯрди -->
  <script>
    // script.js рдореЗрдВ firebase.initializeApp рд╣реЛ рдЪреБрдХрд╛ рд╣реИ; рд╡рд╣реА db/logic reuse
    (function bindActiveEvent(){
      const headingEl = document.getElementById("formHeading");
      const reasonSel = document.getElementById("reason");
      function ensureOptionAndSelect(value){
        if(!value) return;
        const exists = Array.from(reasonSel.options).some(o=>o.value===value);
        if(!exists){
          const op=document.createElement('option'); op.value=value; op.textContent=value;
          // placeholder рдХреЗ рдмрд╛рдж insert
          if (reasonSel.firstChild && reasonSel.firstChild.tagName==="OPTION" && reasonSel.firstChild.value===""){
            reasonSel.insertBefore(op, reasonSel.firstChild.nextSibling);
          } else { reasonSel.insertBefore(op, reasonSel.firstChild); }
        }
        reasonSel.value = value;
      }
      function sanitizeIfNA(){
        const v=(reasonSel.value||'').trim().toLowerCase();
        if(v==='na'||v==='n/a') reasonSel.value='';
      }
      firebase.firestore().collection('events').where('active','==',true).limit(1).onSnapshot(s=>{
        const d=s.docs[0]?.data(); const evName=(d?.name||'').toString().trim();
        if(evName){ headingEl.textContent=`рдЗрд╡реЗрдВрдЯ: ${evName}`; sanitizeIfNA(); ensureOptionAndSelect(evName); }
        else { headingEl.textContent='рднрд╛рдЬрдкрд╛ рдХрд╛рд░реНрдпрд╛рд▓рдп рдкрд░ рдЖрдкрдХрд╛ рд╕реНрд╡рд╛рдЧрдд рд╣реИ'; }
      });
    })();

    // ЁЯФН рдореЛрдмрд╛рдЗрд▓ рд╕рд░реНрдЪ рдмрдЯрди рд╕реЗ рднреА blur рдЬреИрд╕рд╛ auto-fill рдЯреНрд░рд┐рдЧрд░
    (function hookMobileSearch(){
      const btn = document.getElementById('mobileSearch');
      const input = document.getElementById('mobile');
      btn?.addEventListener('click', ()=> input.dispatchEvent(new Event('blur')) );
    })();
  </script>
</body>
</html>
