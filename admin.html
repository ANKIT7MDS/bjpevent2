<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin ‚Ä¢ Events</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari&display=swap" rel="stylesheet">

  <!-- üîÅ ‡§Ü‡§™‡§ï‡•Ä ‡§™‡•Å‡§∞‡§æ‡§®‡•Ä admin.css ‡§ï‡•ã inline ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à -->
  <style>
  * { box-sizing: border-box; }
  body {
    font-family: 'Noto Sans Devanagari', system-ui, -apple-system, Arial, sans-serif;
    background: #f6f6f6;
    margin: 0;
  }
  .container {
    max-width: 1220px;
    margin: 24px auto;
    background: #fff;
    padding: 18px 18px 26px;
    border-radius: 14px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.08);
  }

  /* Header */
  .header { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
  .header h1 { margin:0; }
  .export-top {
    padding: 10px 16px; border: none; border-radius: 10px;
    background: #ff6a00; color: #fff; font-weight: 700; cursor: pointer;
    margin-bottom: 10px;
  }
  .export-top:hover { background: #e55f00; }

  /* Filters row */
  .filters {
    display: grid;
    grid-template-columns: repeat(6, minmax(140px, 1fr));
    gap: 10px;
    margin: 14px 0 16px;
  }
  .filter-item { display: flex; flex-direction: column; gap: 6px; }
  .filter-item.grow { grid-column: span 2; }
  .filter-item.shrink { align-self: end; }
  .filters label { font-size: 13px; color: #333; font-weight: 700; }
  input, select, button {
    padding: 10px; border: 1px solid #e4e6ef; border-radius: 8px; font-size: 15px;
  }

  /* Table */
  .table-wrap { overflow: auto; border:1px solid #eee; border-radius: 10px; }
  table { width:100%; border-collapse: collapse; }
  th, td { padding: 10px; border-bottom: 1px solid #eee; text-align: left; }
  th { background:#fafafa; font-weight:800; }

  .pill { padding:4px 8px; border-radius:999px; font-size:12px; background:#eef2ff; display:inline-block; }
  .danger { background:#fee2e2; color:#991b1b; }
  .muted { color:#6b7280; font-size:13px; }
  .btn { background:#0d6efd; color:#fff; border:none; cursor:pointer; padding:8px 12px; border-radius:8px; }
  .btn.danger { background:#dc2626; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>‡§á‡§µ‡•á‡§Ç‡§ü ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§®</h1>
      <button class="export-top" id="btnClearActive">Active ‡§π‡§ü‡§æ‡§è‡§Å</button>
    </div>

    <div class="filters">
      <div class="filter-item grow">
        <label>‡§á‡§µ‡•á‡§Ç‡§ü ‡§ï‡§æ ‡§®‡§æ‡§Æ</label>
        <input id="eventName" placeholder="‡§á‡§µ‡•á‡§Ç‡§ü ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡•á‡§Ç">
      </div>
      <div class="filter-item shrink">
        <label>&nbsp;</label>
        <button id="btnAdd" class="btn">‡§á‡§µ‡•á‡§Ç‡§ü ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</button>
      </div>
    </div>

    <div class="table-wrap">
      <table>
        <thead><tr><th>‡§®‡§æ‡§Æ</th><th>‡§∏‡•ç‡§•‡§ø‡§§‡§ø</th><th>‡§ï‡§æ‡§∞‡•ç‡§∞‡§µ‡§æ‡§à</th></tr></thead>
        <tbody id="eventRows"></tbody>
      </table>
    </div>

    <p class="muted" style="margin-top:10px;">* ‡§è‡§ï ‡§∏‡§Æ‡§Ø ‡§Æ‡•á‡§Ç ‡§ï‡•á‡§µ‡§≤ ‡§è‡§ï ‡§á‡§µ‡•á‡§Ç‡§ü Active ‡§∞‡§ñ‡•á‡§Ç‡•§</p>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<script>
  // --- Firebase init ---
  const firebaseConfig = {
    apiKey: "AIzaSyD-xaGtrczkUCT7rwEOuRnHzVE9AohYsKU",
    authDomain: "bjplivefirebase.firebaseapp.com",
    projectId: "bjplivefirebase",
    storageBucket: "bjplivefirebase.firebasestorage.app",
    messagingSenderId: "236867156337",
    appId: "1:236867156337:web:1fbd6c535689a6f34d5ed0",
    measurementId: "G-M5KY8DW9JD"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const $ = (id) => document.getElementById(id);
  const rows = $('eventRows');

  async function setOnlyThisActive(docId) {
    const batch = db.batch();
    const all = await db.collection('events').get();
    all.forEach(d => batch.update(d.ref, { active: d.id === docId }));
    await batch.commit();
  }

  async function clearActive() {
    const all = await db.collection('events').where('active','==',true).get();
    const batch = db.batch();
    all.forEach(d => batch.update(d.ref, { active:false }));
    await batch.commit();
  }

  $('btnAdd').addEventListener('click', async () => {
    const name = $('eventName').value.trim();
    if (!name) return alert('‡§®‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç');
    await db.collection('events').add({ name, active:false, createdAt: firebase.firestore.FieldValue.serverTimestamp() });
    $('eventName').value='';
  });

  $('btnClearActive').addEventListener('click', async () => {
    await clearActive();
    alert('Active ‡§á‡§µ‡•á‡§Ç‡§ü ‡§π‡§ü‡§æ‡§Ø‡§æ ‡§ó‡§Ø‡§æ');
  });

  function render(docs) {
    rows.innerHTML = '';
    docs.forEach(doc => {
      const d = doc.data();
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${d.name || ''}</td>
        <td>${d.active ? '<span class="pill">Active</span>' : '<span class="pill">Inactive</span>'}</td>
        <td>
          <button data-id="${doc.id}" class="btn">Active ‡§ï‡§∞‡•á‡§Ç</button>
          <button data-id="${doc.id}" class="btn danger">Delete</button>
        </td>`;
      rows.appendChild(tr);
    });

    rows.querySelectorAll('.btn').forEach(b => {
      if (b.classList.contains('danger')) {
        b.addEventListener('click', async (e) => {
          const id = e.currentTarget.getAttribute('data-id');
          if (!confirm('‡§™‡§ï‡•ç‡§ï‡§æ ‡§π‡§ü‡§æ‡§®‡§æ ‡§π‡•à?')) return;
          await db.collection('events').doc(id).delete();
        });
      } else {
        b.addEventListener('click', async (e) => {
          const id = e.currentTarget.getAttribute('data-id');
          await setOnlyThisActive(id);
          alert('‡§Ø‡§π ‡§á‡§µ‡•á‡§Ç‡§ü ‡§Ö‡§¨ Active ‡§π‡•à');
        });
      }
    });
  }

  db.collection('events').orderBy('createdAt','desc').onSnapshot(snap => render(snap.docs));
</script>
</body>
</html>
